<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>express的使用</title>
</head>

<body>
    <!-- express
    1、概念
        express的作用和Node。js内置的http模块类似，是专门用来创建Web服务器的，express是基于http模块进一步封装出来的，相比于http方法更全面、更简洁，是一个npm上的第三方包。
    2、express的使用
        ()下载express包，在项目所处的目录下：
            npm i express
            
        ()创建基本的Web服务器
            //1.导入express包
                const express = require('express')
            //2、创建Web服务器
                const app = express()
            //3、调用 app.listen(端口号，启动成功后的回调函数)，启动服务器
                app.listen(8000,() => {
                    console.log('8000端口服务器启动中....')
                })

        ()express监听GET请求，这一步叫做路由的简单挂载，后面会学到模块化路由挂载
            //参数1：客户端所请求的URL地址
            //参数2：请求对应的处理函数
            //       request：请求对象（包含了与请求相关的属性和方法）
            //       response：响应对象（包含了与响应相关的属性和方法）
                app.get('请求URL',(req,res) => {

                })
        
        ()express监听POST请求
            与GET请求一模一样
        
        ()把内容响应给客户端
          通过 response.send() 方法，把处理好的内容，发送给客户端：
            app.get('/user',(req,res) => {                  app.post('/user',(res,req) => {
                res.send({      向客户端发送JSON对象             res.send('请求成功')     向客户端发送文本信息
                    name:'ysy',                              })         
                    age:18
                })
            })
        
        ()获取URL中携带的查询参数（query）
          通过 req.query 对象（其本身是个空对象），可以访问到客户端通过查询字符串 http://127.0.0.1/?name=ysy&age=20 的形式，发送到服务器的参数
            app.get('/',(req,res) => {
                //可以通过 req.query.name  访问到
                console.log(req.query) 
            })
        
        ()获取URL中的动态参数（params）
          通过 req.params 对象（默认是个空对象），可以访问到URL中，通过：匹配到的动态参数
          比如客户端的请求地址为 http://127.0.0.1/user/2   那么id = 2 存入req.params
          如果需要匹配多个参数，则，url 写为： "/user/:id/:name"
            app.get('/user/:id',(req,res) => {
                console.log(req.params)   req.params里面存放着通过 ： 动态匹配到的参数值
            })
        
        ()启动服务器
          在控制台：node 写服务器的文件的名字    例如： node web.js
          测试请求服务器：在浏览器或者postman中输入: 127.0.0.1/user -->


    <!-- express托管静态资源
        1、express.static()
            通过static函数，可以创建一个静态资源服务器，第一个参数是访问文件的前缀，可以任意取，一般取与文件夹名字相同
            例如如下代码可以将public目录下的所有文件对外开放访问：
                app.use('/public',express.static('public')) 
            访问public里的文件：
                http://localhost:8080/public/user.png
            托管多个静态资源，就调用多次，写多行上面那个代码-->

    <!--nodemon工具
        (1) 用途：能够帮我们重启服务，可以自动检测node.js（写web服务器的）中的代码变化，一旦变化了，能够自动帮我们重启服务，就不需要我们重新手动重启了.
            注意：下面的postAndget.js 是写了一个web服务器的一个文件
        (2) 安装nodemon，安装需要基于nodejs和npm ，在终端中输入如下指令：
                PS D:\study\WebCode\ajax> npm install -g nodemon
        (3) 安装完之后，我们需要重新启动一下我们的 postAndget.js ，启动的代码如下：
                nodemon postAndget.js
            如果遇到报错“系统上禁止运行脚本”，在前面加上npx
                npx nodemon postAndget.js
        (4) 上面步骤完毕之后，我们修改了代码文件只需要保存就行了，无需重启服务器-->


    <!-- express中的路由
        (1)在express中，路由指的是客户端请求与服务器处理函数之间的映射关系
        (2)express中的路由分为三部分：（app是创建的一个服务器名字）
            app.请求类型（post、get、all）(请求的url地址，处理函数)
        (3)路由的匹配过程
           每当一个请求到达服务器之后，会按照路由顺序进行路由匹配，如果请求类型和请求的URL地址同时匹配成功，Express会将本次请求交给后面的处理函数处理 -->

    <!-- express路由的模块化使用
        (1) 为了方便对路由进行模块化的管理，express不建议按照上面讲解的方法将路由全部都挂载到app上（app.get/app.post...）而是将路由抽离为单独的模块，减少web服务器文件的代码量
        (2) 模块化步骤：
            先创建好web服务器监听：serve.js 文件中
                const express = require('express');
                const app = express();
                app.listen(8000,() => {
                    console.log('http://127.0.0.1持续监听中')
                })

            再创建路由模块对应的 user.js 文件 （例如创建与用户列表相关的路由模块）：
            一般所有的模块化路由模块会存放在一个文件夹router中，router文件夹与serve.js同级
                ()导入express包，创建路由对象
                    const express = require('express');
                    const router = express.Router()
                ()向路由对象上挂载具体的路由，比如下面挂载获取用户列表的路由，可以挂载多个与用户相关的路由路由
                    router.get('/user/list',(req,res) => {
                        res.send('Get list succeed')
                    })
                ()向外导出路由对象
                    module.exports = router
            
            最后注册路由模块（也就是建立起web服务器与模块化路由之间的关系），在serve.js文件中
                ()导入路由模块，上一步创建的user.js文件是我们想要的
                    const userRouter = require('./router/user.js')
                ()注册路由模块
                    app.use(userRouter)    
                
        (3)添加模块化路由器前缀
           添加了之后，在之后的访问中，只要是访问到该模块路由，就必须在url地址中添加前缀，再添加定义的url地址
                app.use('/api',userRouter)
            访问的地址：http://127.0.0.1/api/user/list-->
</body>

</html>